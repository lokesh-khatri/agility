var pages=pages||{};pages.timer=pages.timer||function(){function n(){$.get("./javascripts/templates/mobster.mustache").success(function(n){q=n}).then(t)}function t(){I=$(".counter"),C=I.find(".counter-text"),G=$("input.period"),B=$(".nav-timer"),R=$(".nav-timer-stop"),U=$(".nav-timer-play"),Y=$(".nav-timer-pause"),j=$(".nav-timer-settings"),M=$(".add-mobster"),z=$(".mobster-container"),x=$("title"),saveLink=$(".save-settings"),y=$(".turn-text"),F=[],H=0,saveLink.bind("click",e),I.bind("click",function(){V===K.STOPPED?f():V===K.PAUSED?b():V===K.PLAYING&&m()}),R.bind("click",P),U.bind("click",function(){V===K.STOPPED?f():b()}),Y.bind("click",m),j.bind("click",m),M.bind("click",r),window.Notification&&Notification.requestPermission(),P(),o()}function e(){searchString="?";for(i in F)mobsterName=$(F[i].name).val(),"?"!=searchString&&(searchString+="&"),searchString+="mobster="+encodeURIComponent(mobsterName);searchString+="&duration="+G.val(),window.location.replace(searchString)}function o(){var n=window.location.search;if(n){var t=n.replace("?","").split("&");for(i in t){var e=t[i].split("=");if("duration"===e[0]&&$("#period").val(e[1]),"mobster"===e[0]){r();var o=$(".mobster-container").first(),a=o.find(".mobster-control-name")[i];$(a).val(decodeURIComponent(e[1]))}}}}function r(){var n=F.length,t=$(Mustache.render(q,{id:n})),e={root:t,name:t.find(".mobster-control-name")[0],disabled:!1};t.find(".mobster-control-turn").bind("click",function(){e.disabled||(H=e.root.index(),g())}),t.find(".mobster-control-up").bind("click",function(){var n=e.root.index();if(0!==n){var t=F[n-1];e.root.after(t.root),F[n]=F[n-1],F[n-1]=e}}),t.find(".mobster-control-down").bind("click",function(){var n=e.root.index();if(n!==F.length){var t=F[n+1];e.root.before(t.root),F[n]=F[n+1],F[n+1]=e}}),t.find(".mobster-control-disable").bind("click",function(){e.disabled||e===F[H]?(e.disabled=!1,e.root.removeClass("disabled")):(e.disabled=!0,e.root.addClass("disabled"))}),F.push(e),z.append(e.root)}function a(){return 60*parseInt(G[0].value,10)}function c(){J=a()}function s(){return getComputedStyle(I[0])["background-color"]}function l(){if("granted"===Notification.permission){var n="Click here and step away from the keyboard.";p()&&(n+="\n"+F[H].name.value+" is next"),O=new Notification("It's time to rotate!",{body:n,icon:"./images/rotate.png",vibrate:[200,100,200]}),O.onclick=function(){window.focus(),O.close()}}$("audio.alert")[0].play()}function d(n){C.text(n),u()}function u(){var n=["["+C.text()+"]"];p()&&n.push(k()+"'s Turn"),n.push("- Agility Timer"),x.text(n.join(" "))}function f(){S(K.PLAYING),c(),d(T(J)),I.css({"background-color":Q.START,transition:"none"}),g(),A()}function m(){V===K.PLAYING&&(S(K.PAUSED),I.css({"background-color":s()}),D())}function b(){S(K.PLAYING),I.css({"background-color":Q.END,transition:"background-color "+J+"s"}),A()}function v(){S(K.STOPPED),D(),d("Rotate"),h(),l()}function p(){return F.filter(function(n){return!n.disabled}).length>=2}function g(){if(F.forEach(function(n){n.root.removeClass("active")}),p()){var n=F[H];y.text(n.name.value+"'s Turn"),n.root.addClass("active")}else y.empty();u()}function h(){if(p()){do H++,H>=F.length&&(H=0);while(F[H].disabled);y.text(k()+" is next")}else y.empty();u()}function k(){return F[H].name.value}function P(){S(K.STOPPED),D(),d("Start"),I.removeAttr("style")}function S(n){I.removeClass(V),V=n,I.addClass(n);var t;switch(n){case K.PLAYING:t=U;break;case K.PAUSED:t=Y;break;case K.STOPPED:t=R}E(t),O&&O.close()}function E(n){B.children().each(function(){$(this).removeClass("active")}),n.addClass("active")}function N(){J===a()&&I.css({"background-color":Q.END,transition:"background-color "+J+"s"}),J--,d(T(J)),0===J&&v()}function A(){L&&clearInterval(L),L=setInterval(N,1e3)}function D(){clearInterval(L),L=null}function T(n){var t=Math.floor(n/60),e=n%60;return w(t)+":"+w(e)}function w(n){return(10>n?"0":"")+n}var I,x,C,y,L,O,G,U,Y,R,j,B,M,q,z,F,H,J=0,K={STOPPED:"stopped",PLAYING:"playing",PAUSED:"paused"},Q={START:"#71B284",END:"#B22727"},V=K.STOPPED;return{init:n}}(),pages.timer.init();